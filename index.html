<index.html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Painel TV - Ajuste Final</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { 
            font-family: 'Chakra Petch', sans-serif; 
            background-color: #000000; 
            color: #e2e8f0; 
            height: 100vh; 
            width: 100vw;
            overflow: hidden; 
        }
        
        @media (max-width: 768px) {
            body { overflow-y: auto; }
            .mobile-scroll { min-height: 100vh; }
        }

        .fade-enter-active { animation: fadeIn 0.6s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }
        #progress-bar { transition: width linear; }
        .neon-text-blue { text-shadow: 0 0 5px rgba(96, 165, 250, 0.5); }
        .neon-text-green { text-shadow: 0 0 5px rgba(74, 222, 128, 0.5); }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="flex flex-col p-2 md:p-4 pb-4 md:pb-6 mobile-scroll">

    <header class="relative flex flex-col md:flex-row justify-between items-center mb-2 shrink-0 border-b border-gray-800 pb-2 gap-2 md:gap-0 transition-all duration-500">
        
        <div class="w-full md:w-1/3 flex flex-row md:flex-col justify-between md:justify-center items-center md:items-start order-2 md:order-1">
            <p id="clock" class="text-4xl md:text-7xl font-mono text-white font-bold tracking-tighter leading-none">00:00</p>
            <div class="flex items-center gap-3 mt-1 pl-1">
                <div class="flex items-center gap-1.5 bg-gray-900/80 px-2 py-0.5 rounded">
                    <span class="relative flex h-2 w-2 md:h-3 md:w-3"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span><span class="relative inline-flex rounded-full h-2 w-2 md:h-3 md:w-3 bg-green-500"></span></span>
                    <p class="text-green-500 text-[10px] md:text-sm font-bold tracking-widest">AO VIVO</p>
                </div>
                <span id="header-date" class="text-sm md:text-xl text-gray-400 font-bold border-l-2 border-gray-700 pl-3">--/--</span>
            </div>
        </div>

        <div class="w-full md:w-1/3 flex flex-col justify-center items-center order-1 md:order-2 mb-2 md:mb-0">
            <div class="flex items-center gap-3">
                <div id="header-icon" class="p-2 md:p-3 rounded-xl bg-gray-900 shadow-lg transition-colors duration-500">
                    <i data-lucide="clock" class="w-6 h-6 md:w-8 md:h-8"></i>
                </div>
                <h1 id="page-title" class="text-2xl md:text-4xl font-bold text-white tracking-wide leading-none drop-shadow-md transition-colors duration-500 text-center">CARREGANDO</h1>
            </div>
            <span id="page-count" class="text-[10px] md:text-sm text-gray-500 font-bold tracking-widest uppercase bg-gray-900 px-3 py-0.5 rounded mt-1">...</span>
        </div>

        <div class="w-full md:w-1/3 flex justify-end items-center order-3">
            <div id="weather-box-general" class="flex flex-col items-end hidden bg-gray-900/40 px-4 py-2 rounded-xl border border-gray-700/50 shadow-lg backdrop-blur-sm">
                <span class="text-[10px] md:text-xs uppercase tracking-[0.2em] font-bold text-gray-500 mb-1">BASE ARICANDUVA</span>
                <div class="flex items-center gap-4">
                    <i id="weather-icon-gen" data-lucide="cloud" class="w-8 h-8 md:w-12 md:h-12 text-blue-400"></i>
                    <span id="weather-temp-gen" class="text-3xl md:text-6xl font-bold font-mono text-white leading-none">--¬∞</span>
                    <div class="h-8 w-px bg-gray-700"></div>
                    <div class="flex flex-col leading-none" id="weather-minmax-container">
                        <span id="weather-max-gen" class="text-sm md:text-xl text-orange-400 font-mono font-bold">Max --¬∞</span>
                        <span id="weather-min-gen" class="text-sm md:text-xl text-blue-300 font-mono font-bold">Min --¬∞</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="flex-grow w-full relative mb-1"> <div id="content-grid" class="grid grid-cols-1 landscape:grid-cols-2 md:grid-cols-2 md:grid-rows-3 gap-2 md:gap-4 w-full h-auto md:h-full pb-14 md:pb-2"></div>
        
        <div id="loading" class="absolute inset-0 flex items-center justify-center bg-black/95 z-50">
            <div class="text-center">
                <div class="w-12 h-12 md:w-24 md:h-24 border-t-4 border-b-4 border-blue-500 rounded-full animate-spin mx-auto mb-4 md:mb-6"></div>
                <p class="text-lg md:text-3xl text-blue-400 animate-pulse font-bold tracking-widest">BUSCANDO DADOS</p>
                <p id="debug-status" class="text-gray-500 mt-2 text-xs md:text-sm font-mono">Iniciando...</p>
                <button onclick="loadMockData()" class="mt-6 px-4 py-2 bg-gray-800 text-[10px] md:text-xs text-gray-400 rounded hover:bg-gray-700 transition">Modo Demo</button>
            </div>
        </div>
    </main>

    <button onclick="manualPrev()" class="md:hidden fixed bottom-6 left-6 bg-blue-600/90 text-white p-4 rounded-full shadow-[0_0_20px_rgba(37,99,235,0.6)] z-50 hover:bg-blue-500 active:scale-95 transition-all border border-blue-400 backdrop-blur-sm"><i data-lucide="chevron-left" class="w-8 h-8"></i></button>
    <button onclick="manualNext()" class="md:hidden fixed bottom-6 right-6 bg-blue-600/90 text-white p-4 rounded-full shadow-[0_0_20px_rgba(37,99,235,0.6)] z-50 hover:bg-blue-500 active:scale-95 transition-all border border-blue-400 backdrop-blur-sm"><i data-lucide="chevron-right" class="w-8 h-8"></i></button>
    
    <div class="fixed bottom-0 left-0 h-1 md:h-1.5 bg-gray-900 w-full z-40"><div id="progress-bar" class="h-full w-0"></div></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>
        const SLIDE_DURATION = 15; 
        const MAX_ITEMS = 6;
        const GOOGLE_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSyjL1-2gPDomF8BJK_rsdVBHjP9VYposkyL8Plxk0bjOcCoUGDWwd9PncCvYuAHdRWQjGftH9pFBgN/pub?output=csv";
        const PROXY_URL = "https://corsproxy.io/?"; 

        const cityCache = {}; 
        const weatherCache = {}; 
        const BASE_LAT = "-23.565"; const BASE_LON = "-46.520"; 

        function updateBaseWeather() {
            fetchWeather(BASE_LAT, BASE_LON).then(data => {
                if(!data) return;
                document.getElementById('weather-temp-gen').innerText = Math.round(data.temp) + "¬∞";
                document.getElementById('weather-max-gen').innerText = `‚¨Ü${data.max}¬∞`;
                document.getElementById('weather-min-gen').innerText = `‚¨á${data.min}¬∞`;
                const iconElement = document.getElementById('weather-icon-gen');
                iconElement.setAttribute('data-lucide', getWeatherIconName(data.code));
                document.getElementById('weather-box-general').classList.remove('hidden');
                lucide.createIcons();
            });
        }

        function getWeatherIconName(code) {
            if (code >= 0 && code <= 3) return 'cloud-sun';
            if (code >= 45 && code <= 48) return 'cloud-fog';
            if (code >= 51 && code <= 67) return 'cloud-rain';
            if (code >= 71 && code <= 77) return 'snowflake';
            if (code >= 80 && code <= 99) return 'cloud-lightning';
            return 'sun';
        }

        async function fetchWeather(lat, lon) {
            const cacheKey = `${lat},${lon}`;
            const now = Date.now();
            if (weatherCache[cacheKey] && (now - weatherCache[cacheKey].timestamp < 600000)) return weatherCache[cacheKey].data;
            try {
                const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code&daily=temperature_2m_max,temperature_2m_min&timezone=America%2FSao_Paulo&forecast_days=1`;
                const res = await fetch(url);
                if(!res.ok) throw new Error("Erro API");
                const json = await res.json();
                const data = { 
                    temp: Math.round(json.current.temperature_2m), 
                    code: json.current.weather_code, 
                    min: Math.round(json.daily.temperature_2m_min[0]),
                    max: Math.round(json.daily.temperature_2m_max[0])
                };
                weatherCache[cacheKey] = { timestamp: now, data: data };
                return data;
            } catch (e) { console.error("Erro Clima", e); return null; }
        }

        async function resolveCity(rawText) {
            if (!rawText || rawText.length < 3 || rawText.includes("---")) return null;
            let clean = rawText.replace(/[0-9]/g, '').trim().replace(/\s\s+/g, ' ');
            if(clean.length < 3) return null;
            if(cityCache[clean]) return cityCache[clean];
            try {
                let q = encodeURIComponent(clean + ", Brazil");
                let url = `https://geocoding-api.open-meteo.com/v1/search?name=${q}&count=1&language=pt&format=json`;
                let res = await fetch(url);
                let json = await res.json();
                if (!json.results || json.results.length === 0) {
                    q = encodeURIComponent(clean);
                    url = `https://geocoding-api.open-meteo.com/v1/search?name=${q}&count=1&language=pt&format=json`;
                    res = await fetch(url);
                    json = await res.json();
                }
                if (json.results && json.results.length > 0) {
                    const result = { lat: json.results[0].latitude, lon: json.results[0].longitude };
                    cityCache[clean] = result;
                    return result;
                }
            } catch (e) { console.error("Erro Geo", e); }
            return null;
        }

        async function updateCardsWeather(items) {
            for (let item of items) {
                const elId = `weather-${item.ID}`;
                const el = document.getElementById(elId);
                if(!el) continue;
                if (!item.REGIAO || item.REGIAO.trim() === "" || item.REGIAO === "---") { el.innerHTML = ""; continue; }
                
                el.innerHTML = `<span class="text-[10px] text-gray-500 animate-pulse">üîé ${item.REGIAO.substring(0,10)}...</span>`;
                await new Promise(r => setTimeout(r, 150)); 

                const coords = await resolveCity(item.REGIAO);
                if (coords) {
                    const w = await fetchWeather(coords.lat, coords.lon);
                    if (w) {
                        el.innerHTML = `
                            <div class="flex items-center gap-2 bg-black/60 px-3 py-1.5 rounded border border-gray-700/50 shadow-lg">
                                <div class="flex items-center gap-2">
                                    <i data-lucide="${getWeatherIconName(w.code)}" class="w-5 h-5 text-yellow-400"></i>
                                    <span class="text-lg font-bold text-white leading-none">${w.temp}¬∞</span>
                                </div>
                                <div class="w-px h-4 bg-gray-600 mx-1"></div>
                                <div class="flex flex-col leading-none">
                                    <span class="text-[10px] text-gray-400 font-mono font-bold">‚¨Ü${w.max}¬∞</span>
                                    <span class="text-[10px] text-gray-400 font-mono font-bold">‚¨á${w.min}¬∞</span>
                                </div>
                            </div>`;
                        lucide.createIcons();
                    } else { el.innerHTML = `<span class="text-[9px] text-gray-600 opacity-50">S/D</span>`; }
                } else { el.innerHTML = `<span class="text-[9px] text-red-400 opacity-80 font-bold">X ${item.REGIAO}</span>`; }
            }
        }

        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'});
        }
        setInterval(updateClock, 1000);
        updateClock();
        updateBaseWeather(); 
        setInterval(updateBaseWeather, 600000);

        let slides = [];
        let currentSlideIndex = 0;

        function getSignStyle(sin) {
            if (!sin) return { color: "bg-gray-800 text-gray-400 border border-gray-700", icon: "hash", label: "PADR√ÉO" };
            const text = sin.toUpperCase();
            if (text.includes("VERTICAL")) return { color: "bg-orange-600 text-white border border-orange-400 shadow-lg", icon: "signpost", label: "VERTICAL" };
            if (text.includes("HORIZONTAL")) return { color: "bg-cyan-600 text-white border border-cyan-400 shadow-lg", icon: "minus", label: "HORIZ." };
            return { color: "bg-gray-700 text-gray-300 border border-gray-600", icon: "activity", label: text };
        }

        function createCardHTML(data, themeColor) {
            const borderClass = themeColor === 'DIURNO' ? 'border-yellow-500' : 'border-indigo-500';
            const bgBadge = themeColor === 'DIURNO' ? 'bg-yellow-600' : 'bg-indigo-600';
            const isViagem = data.VIAGEM && data.VIAGEM.toUpperCase().includes("X");
            const cardBackground = isViagem ? "bg-[#1f1717] border-r-4 border-r-rose-900/50" : "bg-gray-900";
            const sinStyle = getSignStyle(data.SINALIZACAO);
            const uniqueId = `weather-${data.ID}`;

            return `
            <div class="${cardBackground} border-l-[4px] md:border-l-[8px] ${borderClass} rounded-r-xl px-2 py-2 md:px-5 md:py-3 shadow-2xl flex flex-col justify-between min-h-[140px] md:h-full fade-enter-active relative overflow-hidden group transition-colors duration-500 mb-0">
                <i data-lucide="hard-hat" class="absolute right-[-10px] top-[-10px] w-12 h-12 md:w-24 md:h-24 text-white opacity-[0.04]"></i>
                <div class="flex justify-between items-start z-10 shrink-0">
                    <div class="w-full">
                        <div class="flex justify-between items-start w-full">
                            <div class="flex flex-wrap gap-1 md:gap-2 items-center">
                                <span class="${bgBadge} text-white text-xs md:text-lg font-bold px-1.5 md:px-3 py-0.5 rounded shadow inline-block tracking-wide truncate max-w-[120px] md:max-w-none">${data.OBRA}</span>
                                ${isViagem ? `<span class="bg-rose-700 text-white border border-rose-500 text-[9px] md:text-xs font-bold px-1.5 py-0.5 rounded shadow inline-flex items-center gap-1 tracking-wide animate-pulse"><i data-lucide="map-pin" class="w-3 h-3"></i> VIAGEM</span>` : ''}
                            </div>
                            <div id="${uniqueId}" class="transition-opacity duration-500 min-h-[20px] md:min-h-[24px]"></div>
                        </div>
                        <div class="mt-1 flex justify-between items-center">
                             <div>
                                <span class="text-xl md:text-4xl font-bold text-white tracking-wide block leading-none truncate" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">${data.EQUIPE || 'EQUIPE'}</span>
                                <span class="${sinStyle.color} mt-1 text-[9px] md:text-xs font-bold px-1.5 py-0.5 rounded shadow inline-flex items-center gap-1 tracking-wide"><i data-lucide="${sinStyle.icon}" class="w-3 h-3"></i> ${sinStyle.label}</span>
                             </div>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-2 md:gap-4 mt-1.5 md:mt-1 z-10 flex-grow content-center">
                    <div class="bg-slate-800/50 p-1.5 md:p-2 rounded-lg border border-blue-900/50">
                        <div class="flex items-center gap-1.5 mb-0.5 text-blue-400 font-bold uppercase text-[9px] md:text-xs tracking-wider neon-text-blue"><i data-lucide="truck" class="w-3 h-3 md:w-4 md:h-4"></i> Caminh√£o</div>
                        <div class="text-lg md:text-3xl text-white font-mono font-bold leading-none tracking-wide truncate">${data.PLACA_CAM}</div>
                        <div class="text-blue-300 text-[10px] md:text-sm mt-0.5 font-semibold truncate">${data.CAMINHAO}</div>
                    </div>
                    <div class="bg-slate-800/50 p-1.5 md:p-2 rounded-lg border border-green-900/50">
                        <div class="flex items-center gap-1.5 mb-0.5 text-green-400 font-bold uppercase text-[9px] md:text-xs tracking-wider neon-text-green"><i data-lucide="car" class="w-3 h-3 md:w-4 md:h-4"></i> Apoio</div>
                        <div class="text-lg md:text-3xl text-white font-mono font-bold leading-none tracking-wide truncate">${data.PLACA_APOIO}</div>
                        <div class="text-green-300 text-[10px] md:text-sm mt-0.5 font-semibold truncate">${data.APOIO}</div>
                    </div>
                </div>
                <div class="mt-1 pt-1.5 border-t border-gray-800 z-10 shrink-0">
                    <p class="text-gray-400 text-[10px] md:text-base leading-snug line-clamp-1 font-medium">${data.EQUIP}</p>
                </div>
            </div>`;
        }

        function manualPrev() {
            if(window.slideInterval) clearInterval(window.slideInterval);
            prevSlide();
            window.slideInterval = setInterval(nextSlide, SLIDE_DURATION * 1000);
        }

        function manualNext() {
            if(window.slideInterval) clearInterval(window.slideInterval);
            nextSlide();
            window.slideInterval = setInterval(nextSlide, SLIDE_DURATION * 1000);
        }

        function prevSlide() {
            if (slides.length > 1) {
                if (currentSlideIndex === 0) { currentSlideIndex = slides.length - 1; } 
                else { currentSlideIndex--; }
                renderSlide();
                document.querySelector('main').scrollTop = 0;
            }
            const bar = document.getElementById('progress-bar');
            bar.style.transition = 'none'; bar.style.width = '0%';
            setTimeout(() => { bar.style.transition = `width ${SLIDE_DURATION}s linear`; bar.style.width = '100%'; }, 50);
        }

        function nextSlide() {
            if (slides.length > 0 && currentSlideIndex >= slides.length - 1) { atualizarDados(); }
            if (slides.length > 1) {
                currentSlideIndex = (currentSlideIndex + 1) % slides.length;
                renderSlide();
                document.querySelector('main').scrollTop = 0;
            } else {
                const bar = document.getElementById('progress-bar');
                bar.style.transition = 'none'; bar.style.width = '0%';
                setTimeout(() => { bar.style.transition = `width ${SLIDE_DURATION}s linear`; bar.style.width = '100%'; }, 50);
            }
        }

        function renderSlide() {
            if (slides.length === 0) return;
            document.getElementById('loading').style.display = 'none';

            const slide = slides[currentSlideIndex];
            const container = document.getElementById('content-grid');
            const title = document.getElementById('page-title');
            const dateDisplay = document.getElementById('header-date');
            const pageCount = document.getElementById('page-count');
            
            dateDisplay.innerText = slide.items.length > 0 ? slide.items[0].DATA : "--/--";
            pageCount.innerText = `P√ÅGINA ${currentSlideIndex + 1} / ${slides.length}`;

            if (slide.type === 'DIURNO') {
                title.innerText = "ESCALA DIURNA";
                title.className = "text-2xl md:text-5xl font-bold text-yellow-500 tracking-wide drop-shadow-md leading-none text-center";
                document.getElementById('header-icon').innerHTML = '<i data-lucide="sun" class="w-5 h-5 md:w-8 md:h-8 text-yellow-400"></i>';
                document.getElementById('header-icon').className = "p-2 md:p-3 rounded-xl bg-yellow-500/10 shadow-[0_0_15px_rgba(234,179,8,0.2)]";
                document.getElementById('progress-bar').className = "h-full bg-yellow-500 shadow-[0_0_20px_rgba(234,179,8,0.6)]";
            } else {
                title.innerText = "ESCALA NOTURNA";
                title.className = "text-2xl md:text-5xl font-bold text-indigo-400 tracking-wide drop-shadow-md leading-none text-center";
                document.getElementById('header-icon').innerHTML = '<i data-lucide="moon" class="w-5 h-5 md:w-8 md:h-8 text-indigo-400"></i>';
                document.getElementById('header-icon').className = "p-2 md:p-3 rounded-xl bg-indigo-500/10 shadow-[0_0_15px_rgba(99,102,241,0.2)]";
                document.getElementById('progress-bar').className = "h-full bg-indigo-500 shadow-[0_0_20px_rgba(99,102,241,0.6)]";
            }

            container.innerHTML = slide.items.map(item => createCardHTML(item, slide.type)).join('');
            lucide.createIcons();
            updateCardsWeather(slide.items);

            const bar = document.getElementById('progress-bar');
            bar.style.transition = 'none';
            bar.style.width = '0%';
            setTimeout(() => { bar.style.transition = `width ${SLIDE_DURATION}s linear`; bar.style.width = '100%'; }, 50);
        }

        function processData(rows) {
            let dayItems = []; let nightItems = [];
            rows.forEach((row, index) => {
                let d = { 
                    ID: index, DATA: row[0], TURNO_RAW: row[1], VIAGEM: row[2], 
                    OBRA: row[3], REGIAO: row[4], SIN: row[5], EQUIPE: row[6],  
                    P_CAM: row[7], CAM: row[8], EQUIP: row[9], P_APOIO: row[10], APOIO: row[11]   
                };
                const colObra = (d.OBRA || "").toString().toUpperCase();
                const isLongText = colObra.length > 25; 
                if ((colObra.includes("HORIZONTAL") || colObra.includes("VERTICAL")) && !isLongText) return; 
                if (!d.EQUIPE || d.EQUIPE === "EQUIPE" || d.EQUIPE === "") return; 

                const turnoCol = (d.TURNO_RAW || "").toUpperCase();
                let currentSection = turnoCol.includes("NOTURNO") || turnoCol.includes("TURNO-N") ? 'NOTURNO' : 'DIURNO';

                const item = {
                    TYPE: currentSection, ID: d.ID, DATA: d.DATA || "", VIAGEM: d.VIAGEM || "", 
                    OBRA: d.OBRA || "---", REGIAO: d.REGIAO || "", SINALIZACAO: d.SIN || "", 
                    EQUIPE: d.EQUIPE || "", PLACA_CAM: d.P_CAM || "---", CAMINHAO: d.CAM || "",
                    EQUIP: d.EQUIP || "---", PLACA_APOIO: d.P_APOIO || "---", APOIO: d.APOIO || ""
                };
                if (currentSection === 'DIURNO') dayItems.push(item); else nightItems.push(item);
            });
            slides = [];
            for (let i = 0; i < dayItems.length; i += MAX_ITEMS) slides.push({ type: 'DIURNO', items: dayItems.slice(i, i + MAX_ITEMS) });
            for (let i = 0; i < nightItems.length; i += MAX_ITEMS) slides.push({ type: 'NOTURNO', items: nightItems.slice(i, i + MAX_ITEMS) });
            
            currentSlideIndex = 0;
            if (slides.length > 0) {
                renderSlide();
                if(window.slideInterval) clearInterval(window.slideInterval);
                if(slides.length > 1) { window.slideInterval = setInterval(nextSlide, SLIDE_DURATION * 1000); }
            } else { loadMockData(); }
        }

        // --- SISTEMA REDUNDANTE DE DOWNLOAD ---
        function atualizarDados() {
            const timestamp = Date.now();
            const googleUrlNoCache = GOOGLE_CSV + "&uid=" + timestamp;
            const urls = [
                "https://corsproxy.io/?" + encodeURIComponent(googleUrlNoCache),
                "https://api.allorigins.win/raw?url=" + encodeURIComponent(googleUrlNoCache),
                "https://api.codetabs.com/v1/proxy?quest=" + encodeURIComponent(googleUrlNoCache)
            ];
            let attempt = 0;
            function tryFetch() {
                if (attempt >= urls.length) {
                    document.getElementById('debug-status').innerText = "Falha Geral. Carregando modo offline...";
                    loadMockData(); return;
                }
                document.getElementById('debug-status').innerText = `Tentativa ${attempt + 1} de 3...`;
                fetch(urls[attempt])
                    .then(res => { if (!res.ok) throw new Error("Falha"); return res.text(); })
                    .then(csv => {
                        Papa.parse(csv, { 
                            header: false, skipEmptyLines: true, encoding: "UTF-8", 
                            complete: (results) => { processData(results.data); }
                        }); 
                    })
                    .catch(() => { attempt++; tryFetch(); });
            }
            tryFetch();
            setTimeout(() => { if(document.getElementById('loading').style.display !== 'none') { loadMockData(); } }, 8000);
        }

        function loadMockData() {
            const mockCSV = [
                ["29/12/2025", "TURNO-D", "", "OBRA EXEMPLO (SEM CONEX√ÉO)", "SAO PAULO", "VERTICAL", "EQUIPE ALFA", "ABC-1234", "VW 8.150", "EQUIPAMENTO X", "XYZ-9876", "FIAT UNO"],
                ["29/12/2025", "TURNO-D", "", "MANUTEN√á√ÉO", "JUNDIAI", "HORIZONTAL", "EQUIPE BETA", "DEF-5678", "MERCEDES", "EQUIPAMENTO Y", "GHI-1234", "GOL"]
            ];
            processData(mockCSV);
            document.getElementById('debug-status').innerText = "MODO OFFLINE";
            document.getElementById('debug-status').className = "text-red-500 font-bold mt-2 animate-pulse";
        }

        document.addEventListener("DOMContentLoaded", () => {
            atualizarDados();
            updateBaseWeather(); 
        });
    </script>
</body>
</html>
